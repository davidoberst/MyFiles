<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MyFiles</title>
    <link rel="stylesheet" href="styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
  </head>
  <body>
    <p class="title">MyFiles<i class="fas fa-search"></i></p>
    <center>
      <input
        type="text"
        class="search_bar"
        id="query"
        placeholder="Search for a file in your system"
      />
      <button id="search_bt" class="search_button">
        <i class="fas fa-search"></i>
      </button>
      <div id="loader" class="loader"></div>
    </center>

    <center>
      <div id="containerFiles">
        <p id="resultCounter"></p>

       <div id="result" class="file-list"></div>
      </div>
    </center>

    <script>
      const searchButton = document.getElementById("search_bt");
      const loader = document.getElementById("loader");
      const containerFiles = document.getElementById("containerFiles");
      const resultContainer = document.getElementById("result");
      const resultCounter = document.getElementById("resultCounter");

      searchButton.addEventListener("click", async () => {
        const query = document.getElementById("query").value;

        if (!query) {
          loader.style.display = "block";
          containerFiles.style.display = "none";

          // Espera 800ms para simular carga
          setTimeout(() => {
            loader.style.display = "none";
            containerFiles.style.display = "block";
            resultCounter.textContent = "Please type something first!";
            resultContainer.textContent = "";
          }, 800);

          return;
        }

        loader.style.display = "block";
        containerFiles.style.display = "none";
        resultContainer.textContent = "";
        try {
          let result = await pywebview.api.search_file(query);

          // Mostrar contador en el <p>
          if (result.count === 0) {
            loader.style.display = "block";
            containerFiles.style.display = "none";
            resultContainer.textContent = "";
            resultCounter.textContent = "No files found...";
            resultContainer.textContent = "";
          } else {
            // Mant√©n el contador
            resultCounter.innerHTML = `
          <span class="number">${result.count}</span>
          <span class="text">files found</span>
        `;

            // Pinta los archivos como chips (cuadrito + punto azul)
            resultContainer.innerHTML = result.files
              .map(
                (file) => `
            <div class="file-chip">
              <span class="dot"></span>
              <span class="file-text">${file}</span>
            </div>
          `
              )
              .join("");
          }
        } catch (err) {
          resultContainer.textContent = "Error :" + err;
        } finally {
          loader.style.display = "none";
          containerFiles.style.display = "block";
        }
      });
    </script>
  </body>
</html>
